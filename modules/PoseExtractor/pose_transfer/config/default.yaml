# =============================================================================
# Pose Transfer Configuration v9 (Head Padding)
# =============================================================================

# [0] 입력 모드 설정
# --------------------------------------------------------
input_mode:
  type: "internal"

  internal:
    root_dir: "inputs"
    src_dir: "src"
    ref_dir: "ref"

  external:
    source_path: "/var/data/users/user_123.jpg"
    reference_path: "/var/data/poses/pose_dance.jpg"


# [1] 모델 설정
model:
  backend: "onnxruntime"
  device: "cuda"
  mode: "performance"
  to_openpose: false

# [2] 다중 인물 필터링
person_filter:
  enabled: true
  area_weight: 0.6
  center_weight: 0.4
  min_keypoints: 5
  confidence_threshold: 0.3

# [3] 손 정밀화
hand_refinement:
  enabled: true
  min_hand_size: 48
  max_scale_factor: 4.0

# =============================================================================
# [4] 포즈 전이 & Ghost Legs 클리핑 설정
# =============================================================================
transfer:
  normalization_base: "shoulder_width"
  confidence_threshold: 0.3
  
  # ============================================================
  # Ghost Legs 클리핑 설정
  # ============================================================
  ghost_legs_clipping_enabled: true
  
  # [조절 1] 신뢰도 임계값
  # 값 조절: 너무 많이 절삭 → 낮추기 (1.5, 1.0)
  #          Ghost Legs 남음 → 높이기 (2.5, 3.0)
  lower_body_confidence_threshold: 1.5
  
  # [조절 2] 경계 영역 비율
  # 값 조절: 발이 잘림 → 낮추기 (0.05)
  #          하단 Ghost Legs 남음 → 높이기 (0.12, 0.15)
  lower_body_margin_ratio: 0.025
  
  # [조절 3] 화면 밖 허용 범위 (전이 후 최종 클리핑용)
  visibility_margin: 0.2


# [5] 폴백 전략
fallback:
  symmetric_mirror: true
  hierarchical_estimation: true
  fallback_confidence_decay: 0.5

# [6] 렌더링 스타일
rendering:
  line_thickness: 4
  face_line_thickness: 4
  hand_line_thickness: 4
  point_radius: 2
  background_color: [0, 0, 0]
  kpt_threshold: 0.1

# =============================================================================
# [7] 출력 설정
# =============================================================================
output:
  save_json: true
  save_skeleton_image: true
  save_debug_image: true
  
  # ============================================================
  # 키포인트 기반 자동 크롭 설정 (trans_sk용)
  # ============================================================
  # 전이 결과 키포인트가 원본 이미지 경계를 벗어날 수 있습니다.
  # 이 설정을 활성화하면:
  #   1. 키포인트가 이탈한 방향으로 캔버스를 자동 확장 (패딩)
  #   2. 모든 키포인트가 포함된 영역 + 패딩으로 최종 크롭
  #
  # [ON/OFF] 자동 크롭 활성화
  auto_crop_enabled: true
  
  # [조절] 크롭 패딩 (픽셀)
  # --------------------------------------------------------
  # 키포인트 바운딩 박스 외부에 추가할 기본 여백입니다.
  # 
  # 값 조절 가이드:
  #   - 20: 최소 여백 (키포인트에 딱 맞게)
  #   - 50: 기본값 (적당한 여유)
  #   - 100: 넉넉한 여백
  #   - 150+: 매우 넉넉한 여백
  crop_padding_px: 0
  
  # ============================================================
  # [NEW] 머리 방향 추가 패딩
  # ============================================================
  # 코 벡터(목 → 코)를 기반으로 머리 방향을 파악하고,
  # 그 방향으로 추가 패딩을 넣어 머리가 잘리는 것을 방지합니다.
  #
  # 동작 원리:
  #   1. 목 위치 = 양쪽 어깨의 중심점
  #   2. 머리 방향 = 코 - 목 (정규화)
  #   3. 머리 크기 = 눈 사이 거리 × 2.5 (또는 목-코 거리 × 1.2)
  #   4. 추가 패딩 = 머리 크기 × head_padding_ratio
  #   5. 머리 방향으로 상/하/좌/우 패딩 분배
  #
  # [조절] 머리 크기 대비 추가 패딩 비율
  # --------------------------------------------------------
  # 값 조절 가이드:
  #   - 0.3: 최소 (머리 위쪽에 약간의 여백)
  #   - 0.5: 기본값 (적당한 여유)
  #   - 0.7: 넉넉함 (머리 위/옆으로 충분한 여백)
  #   - 1.0: 매우 넉넉함
  #
  # 머리가 잘린다면: 값을 높이세요 (예: 0.5 → 0.7)
  # 여백이 너무 크다면: 값을 낮추세요 (예: 0.5 → 0.3)
  head_padding_ratio: 0

# [8] 시스템 설정 (파일 관리)
system:
  # 입력 파일 유지 여부 (최우선 적용)
  # true: 작업 후 아무것도 하지 않음 (파일이 inputs 폴더에 그대로 남음) - 반복 테스트용
  # false: 아래 enable_archiving 설정에 따라 이동하거나 삭제함
  retain_inputs: true

  # retain_inputs가 false일 때의 동작
  # true: archive 폴더로 이동 (보관)
  # false: 삭제 (휘발성)
  enable_archiving: false

# [9] 얼굴 부위별 렌더링 제어
face_rendering:
  enabled: true
  
  parts:
    jawline:
      enabled: true
      color: [255, 255, 255]
    left_eyebrow:
      enabled: true
      color: [255, 255, 255]
    right_eyebrow:
      enabled: true
      color: [255, 255, 255]
    nose:
      enabled: true
      color: [255, 255, 255]
    left_eye:
      enabled: true
      color: [255, 255, 255]
    right_eye:
      enabled: true
      color: [255, 255, 255]
    mouth_outer:
      enabled: true
      color: [255, 255, 255]
    mouth_inner:
      enabled: true
      color: [255, 255, 255]