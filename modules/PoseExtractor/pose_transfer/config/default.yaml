# =============================================================================
# Pose Transfer Configuration v13 (User Manual Control)
# =============================================================================

# [0] 입력 모드 설정
input_mode:
  type: "internal"
  internal:
    root_dir: "inputs"
    src_dir: "src"      
    ref_dir: "ref"      
  external:
    source_path: "/var/data/users/user_123.jpg"
    reference_path: "/var/data/poses/pose_dance.jpg"

# [1] 모델 설정
model:
  backend: "onnxruntime"
  device: "cuda"
  mode: "performance"
  to_openpose: false

# [2] 다중 인물 필터링
person_filter:
  enabled: true
  area_weight: 0.6
  center_weight: 0.4
  min_keypoints: 5
  confidence_threshold: 0.3

# [3] 손 정밀화 (작은 손 업스케일링)
hand_refinement:
  enabled: true
  min_hand_size: 48
  max_scale_factor: 4.0

# =============================================================================
# [4] 포즈 전이 설정
# =============================================================================
transfer:
  normalization_base: "shoulder_width"
  
  # 전이 시 사용할 키포인트 최소 신뢰도
  confidence_threshold: 0.3
  
  # (구버전) 하반신 클리핑 - Ghost Filter가 대체하므로 영향력 낮음
  ghost_legs_clipping_enabled: false
  
  # 하반신 전이 여부를 결정하는 최소 신뢰도
  lower_body_confidence_threshold: 0.5
  lower_body_margin_ratio: 0.05
  visibility_margin: 0.5

# =============================================================================
# [5] Ghost Filter (중요: 사용자 수동 제어 구간)
# 키포인트 꼬임 및 골반 소실 문제를 여기서 조정합니다.
# =============================================================================
ghost_filter:
  # 기능 켜기/끄기
  enabled: true

  # ---------------------------------------------------------------------------
  # 1. [꼬임 방지] 점수 임계값 (Score Threshold)
  # ---------------------------------------------------------------------------
  # 이 값보다 점수가 낮은 관절은 '노이즈'로 보고 지웁니다.
  # - 값을 올리면(>0.6): 꼬임은 사라지지만, 멀쩡한 팔다리가 사라질 위험 있음.
  # - 값을 낮추면(<0.3): 팔다리는 잘 보존되지만, 배경 노이즈로 인해 꼬임 발생 가능.
  # * 추천값: 0.4 ~ 0.5 (상황에 맞춰 0.1 단위로 조절하세요)
  ghost_score_threshold: 0.5

  # ---------------------------------------------------------------------------
  # 2. [골반 소실 방지] 해부학적 위치 검증 (Anatomy Order)
  # ---------------------------------------------------------------------------
  # - true: "무릎은 무조건 골반보다 아래에 있어야 한다" (서 있는 자세 전용)
  # - false: "위치 상관없이 점수만 높으면 그린다" (앉은 자세, 다리 꼬기, 발차기 허용)
  # * 중요: 앉아 있거나 역동적인 포즈라면 반드시 'false'로 설정하세요!
  check_anatomy_order: false

  # ---------------------------------------------------------------------------
  # 3. 화면 밖 키포인트 제거
  # ---------------------------------------------------------------------------
  # 화면 밖으로 튀어 나가는 노이즈 제거 (True 권장)
  check_image_bounds: true
  bounds_margin: 0.05

  # ---------------------------------------------------------------------------
  # 4. 손목/팔꿈치 꼬임 방지
  # ---------------------------------------------------------------------------
  # 손목 점수가 이보다 낮으면 손 전체를 지워버림 (공중에 뜬 손 방지)
  wrist_score_threshold: 0.3
  elbow_score_threshold: 0.3

# [6] 폴백 전략 (누락된 부위 복구)
fallback:
  symmetric_mirror: true
  hierarchical_estimation: true
  fallback_confidence_decay: 0.5

# [7] 렌더링 스타일
rendering:
  line_thickness: 4
  face_line_thickness: 2
  hand_line_thickness: 4
  point_radius: 2
  background_color: [0, 0, 0]
  kpt_threshold: 0.1

# [8] 출력 설정
output:
  save_json: true
  save_skeleton_image: true
  save_debug_image: true
  # 캔버스 확장(Padding)을 위해 True 필수
  auto_crop_enabled: false
  canvas_padding_ratio: 0
  crop_padding_px: 0
  head_padding_ratio: 0.5

# [9] 시스템 설정
system:
  retain_inputs: true
  enable_archiving: false

# [10] 디버그 설정 (BBox 확인용)
debug:
  bbox_visualization: true
  visualize_keypoint_bbox: true
  visualize_yolo_bbox: true
  visualize_hybrid_bbox: true

# [11] 정렬 및 스케일 설정
alignment:
  full_body_min_valid_lower: 4
  ghost_score_threshold: 2.0
  yolo_verification_enabled: true
  yolo_person_conf: 0.5
  yolo_face_conf: 0.3
  # Source 얼굴 크기에 맞춰 스케일링하려면 True 필수
  face_scale_enabled: true

# [12] Bbox 여백
bbox:
  person_margin: 0.0
  face_margin: 0.0

# [13] 얼굴 렌더링 (부위별 제어)
face_rendering:
  enabled: true
  parts:
    jawline:
      enabled: false
      color: [255, 255, 255]
    left_eyebrow:
      enabled: true
      color: [255, 255, 255]
    right_eyebrow:
      enabled: true
      color: [255, 255, 255]
    nose:
      enabled: true
      color: [255, 255, 255]
    left_eye:
      enabled: true
      color: [255, 255, 255]
    right_eye:
      enabled: true
      color: [255, 255, 255]
    mouth_outer:
      enabled: true
      color: [255, 255, 255]
    mouth_inner:
      enabled: true
      color: [255, 255, 255]